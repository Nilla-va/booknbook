
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cjcs.bnb.dao.OrderDao">

<!--수희-->
    <select id="getOrderListGroupByOId" parameterType="String" resultType="Map">
        <!-- Map객체에 넣을 때는 아래처럼 as "키이름" 지정해줘야 함 -->
        SELECT o_id as "o_id",
               o_date as "o_date",
               first_title as "first_title",
               COUNT(*)-1 as "book_sorts_minus_one",
               order_status as "order_status",
               o_delivery_sort as "o_delivery_sort"
        FROM (SELECT o_id,
                    o_date,
                    FIRST_VALUE(b_title) OVER(PARTITION BY o_id) AS first_title,
                    order_status,
                    o_delivery_sort
              FROM order_list
              WHERE o_c_id = #{c_id})
        GROUP BY o_id, o_date, first_title, order_status, o_delivery_sort
        ORDER BY o_id DESC
    </select>

    <select id="getOrderInfoByOId" parameterType="Integer" resultType="Map">
        SELECT o_id as "o_id",
               o_date as "o_date",
               o_delivery_sort as "o_delivery_sort",
               o_recip_addr as "o_recip_addr",
               o_recip_name as "o_recip_name",
               o_recip_phone as "o_recip_phone"
        FROM O
        WHERE o_id=#{o_id}
    </select>

<!--예림-->
    <select id="getTodaySellCnt" resultType="int">
        select count(*)
        from order_list
        where to_char(o_date, 'yy/mm/dd') = to_char(sysdate, 'yy/mm/dd') and order_sort = '구매' and s_id = #{s_id}
    </select>
    <!-- <select id="getTodayRentCnt" parameterType="SellerDto" resultType="Integer">
        select count(*)
        from order_list
        where to_char(o_date, 'yy/mm/dd') = to_char(sysdate, 'yy/mm/dd') and order_sort = '대여' and s_id = #{s_id}
    </select>
    <select id="getTodayRentResCnt" parameterType="RentalReservationDto" resultType="Integer">
        select count(*)
        from Rental_Res
        where to_char(rr_reqdate, 'yy/mm/dd') = to_char(sysdate, 'yy/mm/dd') and rr_s_id = #{rr_s_id}
    </select>
    <select id="getTodayDeliveryPrepare" parameterType="SellerDto" resultType="Integer">
        SELECT count(*) AS cnt
        from order_list
        where order_status_id = 4 and deliverydate = sysdate and s_id = #{s_id}
    </select>
    <select id="getTodayDeliverShip" parameterType="SellerDto" resultType="Integer">
        SELECT count(*) AS cnt
        from order_list
        where order_status_id = 6 and deliverydate = sysdate and s_id = #{s_id}
    </select>
    <select id="getTodayDeliverComplete" parameterType="SellerDto" resultType="Integer">
        SELECT count(*) AS cnt
        from order_list
        where order_status_id = 7 and deliverydate = sysdate and s_id = #{s_id}
    </select>
    <select id="getBookmarkMemberCnt" parameterType="SellerDto" resultType="Integer">
        SELECT COUNT(*)
        FROM FavStore
        WHERE FAVS_S_ID = #{s_id}
    </select>
    <select id="getMonthCancelRequest" parameterType="SellerDto" resultType="Integer">
        select count(*)
        from order_list
        where o_date between to_char(sysdate-30, 'yy/mm/dd') and to_char(sysdate, 'yy/mm/dd') and order_status_id = '2' and s_id = #{s_id}
    </select>
    <select id="getMonthReturnRequest" parameterType="SellerDto" resultType="Integer">
        select count(*)
        from Ref_Exch
        where re_reqdate between to_char(sysdate-30, 'yy/mm/dd') and to_char(sysdate, 'yy/mm/dd') re_s_id = #{s_id}
    </select> -->

</mapper>
